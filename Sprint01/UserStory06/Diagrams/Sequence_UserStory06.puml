@startuml
title UserStory06 â€“ Assign Role to Unassigned User (Sequence)

actor "User Admin" as UA
participant "AdminUsersPage\n(Boundary)" as B
participant "UsersController\n(Controller)" as C
participant "User\n(Entity)" as E

== View Unassigned ==
UA -> B : showUnassigned()
B -> C  : listUnassigned()
activate C
C -> E  : unassigned()
activate E
E --> C : return rows[]                 ' users where user_profiles is NULL/''/'Unassigned'
deactivate E
C --> B : return { ok:true, users: rows[] }
deactivate C
B -> UA : render table (Unassigned)

== Open Assign Form ==
UA -> B : showAssignRole(userid)
B -> C  : getUser(userid)
activate C
C -> E  : getById(userid)
activate E
E --> C : return row|null
deactivate E
C --> B : return { ok:true, user: row } / { ok:false, message }
deactivate C
B -> UA : show role dropdown (PIN | User Admin | CSR Rep | Platform Manager)

== Submit Assignment ==
UA -> B : submitAssignRole(userid, role)
B -> C  : assignRole(userid, role)
activate C
C -> E  : updateRole(userid, role)
activate E
E --> C : return true/false
deactivate E
C --> B : return { ok:true, message:"Assigned role 'X' to #ID" } / { ok:false, message }
deactivate C
B -> UA : redirect to Unassigned with flash message
@enduml
