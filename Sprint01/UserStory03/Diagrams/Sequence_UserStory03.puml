@startuml
actor "User Admin" as UA
participant "AdminUsersPage\n<<boundary>>" as B
participant "UsersController\n<<control>>" as C
database "User\n<<entity>>" as E

== View List ==
UA -> B: GET "/"
B -> C: listUsers()
activate C
C -> E: all()
activate E
E --> C: return rows[]
deactivate E
C --> B: return { ok:true, users }
deactivate C
B -> UA: render table

== Edit Form ==
UA -> B: GET "/?edit=userid"
B -> C: getUser(userid)
activate C
C -> E: findById(userid)
activate E
E --> C: return user
deactivate E
C --> B: return { ok:true, user }
deactivate C
B -> UA: show edit form

== Submit Update ==
UA -> B: POST action=update (userid, full_name, email, password, phone, address)
B -> C: updateUser(userid, data)
activate C
C -> C: validate(data)
alt invalid
  C --> B: return { ok:false, message, prefill }
  deactivate C
  B -> UA: show edit (error + prefill)
  return
end

C -> E: existsById(userid)
activate E
E --> C: return true/false
deactivate E
alt not found
  C --> B: return { ok:false, message:"User not found", prefill }
  deactivate C
  B -> UA: show edit (error)
  return
end

C -> E: emailUniqueForUpdate(userid, email)
activate E
E --> C: return true/false
deactivate E
alt not unique
  C --> B: return { ok:false, message:"Email is already in use by another user", prefill }
  deactivate C
  B -> UA: show edit (error+prefill)
  return
end

C -> E: updateBasic(userid, data)
activate E
E --> C: return ok
deactivate E
C --> B: return { ok:true, message:"User #userid updated." }
deactivate C
B -> UA: redirect to list with success

@enduml
